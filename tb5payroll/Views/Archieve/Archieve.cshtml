@{
	Layout = "_ArchieveLayout";
	ViewBag.Title = "Archieve";
}
<div class="d-flex align-items-center gap-2 p-2 bg-light shadow-sm rounded border">
	<label for="monthFilter" class="fw-bold">Month:</label>
	<select id="monthFilter" class="form-select form-select-sm border-primary">
		<option value="">All</option>
		<option value="01">January</option>
		<option value="02">February</option>
		<option value="03">March</option>
		<option value="04">April</option>
		<option value="05">May</option>
		<option value="06">June</option>
		<option value="07">July</option>
		<option value="08">August</option>
		<option value="09">September</option>
		<option value="10">October</option>
		<option value="11">November</option>
		<option value="12">December</option>
	</select>

	<label for="yearFilter" class="fw-bold">Year:</label>
	<select id="yearFilter" class="form-select form-select-sm border-primary">
		<option value="">All</option>
	</select>
</div>

<!-- Search Bar & Controls -->
<div class="d-flex justify-content-between align-items-center p-2 shadow-sm rounded bg-light border">
	<input type="text" id="searchInput" class="form-control form-control-sm w-25 border-primary"
		   placeholder="🔍 Search Employee..." onkeyup="searchEmployee()">
</div>
<!-- Employee Table -->
<div class="table-responsive" style="max-height: 370px; overflow-y: auto; border: 1px solid #ccc;">
	<table class="table table-sm table-bordered text-center" id="employeeTable" style="margin-bottom: 0; font-size: 17px;">
		<thead class="table-dark" style="background-color: skyblue;">
			<tr>
				<th style="z-index: 2; background: skyblue;">ID No</th>
				<th style="z-index: 2; background: skyblue;">Name</th>
				<th style="z-index: 2; background: skyblue;">Department</th>
				<th style="z-index: 2; background: skyblue;">Holiday</th>
				<th style="z-index: 2; background: skyblue;">Overtime</th>
				<th style="z-index: 2; background: skyblue;">Hours Worked</th>
				<th style="z-index: 2; background: skyblue;">Actions</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>33847834</td>
				<td><a>John Doe</a></td>
				<td>TB5 STAFF</td>
				<td>10</td>
				<td>20</td>
				<td>110</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>433834</td>
				<td><a>Jane Doe</a></td>
				<td>TB5 STAFF</td>
				<td>12</td>
				<td>20</td>
				<td>98</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>2277834</td>
				<td><a>Johnny Sins</a></td>
				<td>TB5 STAFF</td>
				<td>13</td>
				<td>22</td>
				<td>115</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>33847834</td>
				<td><a>John Doe</a></td>
				<td>TB5 STAFF</td>
				<td>10</td>
				<td>20</td>
				<td>110</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>433834</td>
				<td><a>Jane Doe</a></td>
				<td>TB5 STAFF</td>
				<td>12</td>
				<td>20</td>
				<td>98</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>2277834</td>
				<td><a>Johnny Sins</a></td>
				<td>TB5 STAFF</td>
				<td>13</td>
				<td>22</td>
				<td>115</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>33847834</td>
				<td><a>John Doe</a></td>
				<td>TB5 STAFF</td>
				<td>10</td>
				<td>20</td>
				<td>110</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>433834</td>
				<td><a>Jane Doe</a></td>
				<td>TB5 STAFF</td>
				<td>12</td>
				<td>20</td>
				<td>98</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>2277834</td>
				<td><a>Johnny Sins</a></td>
				<td>TB5 STAFF</td>
				<td>13</td>
				<td>22</td>
				<td>115</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>33847834</td>
				<td><a>John Doe</a></td>
				<td>TB5 STAFF</td>
				<td>10</td>
				<td>20</td>
				<td>110</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>433834</td>
				<td><a>Jane Doe</a></td>
				<td>TB5 STAFF</td>
				<td>12</td>
				<td>20</td>
				<td>98</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
			<tr>
				<td>2277834</td>
				<td><a>Johnny Sins</a></td>
				<td>TB5 STAFF</td>
				<td>13</td>
				<td>22</td>
				<td>115</td>
				<td>
					<button class="btn btn-primary btn-view">View</button>
					<button class="btn btn-danger btn-delete">Delete</button>
				</td>
			</tr>
		</tbody>
	</table>
</div>

<!-- 1st Cutoff Modal -->
<div class="modal fade" id="payslipModal" tabindex="-1" aria-labelledby="payslipModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="payslipTitle">Payslip - Semi-Monthly Payroll (1st Cut-off: 1st - 15th)</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<h4 class="text-center">THE BIG FIVE TRAINING AND ASSESSMENT CENTER</h4>
				<div><strong>Employee:</strong> <span id="payslipEmployeeName">John Doe</span></div>

				<table class="table table-bordered">
					<thead class="table-dark">
						<tr>
							<th>Overtime</th>
							<th>Min</th>
							<th>Pay</th>
							<th>Deduction</th>
							<th>Amount</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Regular</td>
							<td><span id="payslipMinutes">62.50</span></td>
							<td>0.00</td>
							<td>W/H Tax</td>
							<td><span id="payslipTax">0.00</span></td>
						</tr>
						<tr>
							<td>Training</td>
							<td><span id="payslipTrainingMinutes">1000.00</span></td>
							<td>0.00</td>
							<td>SSS</td>
							<td><span id="payslipSSS">0.00</span></td>
						</tr>
						<tr>
							<td colspan="3" class="text-center"><strong>TRAINING DETAILS</strong></td>
							<td>PAG-IBIG</td>
							<td><span id="payslipPagIbig">0.00</span></td>
						</tr>
						<tr>
							<td>Batch/s</td>
							<td>Days</td>
							<td>Training Dates</td>
							<td>Tardiness</td>
							<td><span id="payslipTardiness">0.00</span></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td>Loan</td>
							<td><span id="payslipLoan">0.00</span></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td>Others / C.A.</td>
							<td><span id="payslipOthers">0.00</span></td>
						</tr>
					</tbody>
				</table>

				<div>
					<strong>Deduction:</strong> <span id="payslipTotalDeduction">0.00</span><br>
					<strong>Overtime:</strong> <span id="payslipOvertime">0.00</span><br>
					<strong>Training:</strong> <span id="payslipTraining">0.00</span><br>
					<strong>Gross Pay:</strong> <span id="payslipGrossPay">0.00</span><br>
					<strong>Net Pay:</strong> <span id="payslipNetPay">0.00</span><br>
				</div>

				<div class="mt-3">
					<strong>Received By:</strong> ________________________
				</div>
				<div class="mt-3 text-end">
					<strong>Approved By:</strong> Danver S. Reyes
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" id="nextCutoff">Next</button>
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary btn-print" data-modal="payslipModal">Print</button>
			</div>
		</div>
	</div>
</div>


<!-- 2nd Cutoff Modal -->
<!-- 2nd Cutoff Modal -->
<div class="modal fade" id="payslipModalSecond" tabindex="-1" aria-labelledby="payslipModalSecondLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">

			<div class="modal-header">
				<h5 class="modal-title" id="payslipTitleSecond">Payslip - Semi-Monthly Payroll (2nd Cut-off: 16th - 30th/31st)</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<h4 class="text-center">THE BIG FIVE TRAINING AND ASSESSMENT CENTER</h4>
				<div><strong>Employee:</strong> <span id="payslipEmployeeName">John Doe</span></div>

				<table class="table table-bordered">
					<thead class="table-dark">
						<tr>
							<th>Overtime</th>
							<th>Min</th>
							<th>Pay</th>
							<th>Deduction</th>
							<th>Amount</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Regular</td>
							<td><span id="payslipMinutes">62.50</span></td>
							<td>0.00</td>
							<td>W/H Tax</td>
							<td><span id="payslipTax">0.00</span></td>
						</tr>
						<tr>
							<td>Training</td>
							<td><span id="payslipTrainingMinutes">1000.00</span></td>
							<td>0.00</td>
							<td>SSS</td>
							<td><span id="payslipSSS">0.00</span></td>
						</tr>
						<tr>
							<td colspan="3" class="text-center"><strong>TRAINING DETAILS</strong></td>
							<td>PAG-IBIG</td>
							<td><span id="payslipPagIbig">0.00</span></td>
						</tr>
						<tr>
							<td>Batch/s</td>
							<td>Days</td>
							<td>Training Dates</td>
							<td>Tardiness</td>
							<td><span id="payslipTardiness">0.00</span></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td>Loan</td>
							<td><span id="payslipLoan">0.00</span></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td>Others / C.A.</td>
							<td><span id="payslipOthers">0.00</span></td>
						</tr>
					</tbody>
				</table>

				<div>
					<strong>Deduction:</strong> <span id="payslipTotalDeduction">0.00</span><br>
					<strong>Overtime:</strong> <span id="payslipOvertime">0.00</span><br>
					<strong>Training:</strong> <span id="payslipTraining">0.00</span><br>
					<strong>Gross Pay:</strong> <span id="payslipGrossPay">0.00</span><br>
					<strong>Net Pay:</strong> <span id="payslipNetPay">0.00</span><br>
				</div>

				<div class="mt-3">
					<strong>Received By:</strong> ________________________
				</div>
				<div class="mt-3 text-end">
					<strong>Approved By:</strong> Danver S. Reyes
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" id="nextCutoff">Next</button>
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary btn-print" data-modal="payslipModal">Print</button>
			</div>
		</div>
	</div>
</div> 
<!-- Pagination Controls -->
<div class="d-flex justify-content-between mt-3">
	<button id="prevPage" class="btn btn-secondary" disabled>Previous</button>
	<span id="pageInfo">Page 1</span>
	<button id="nextPage" class="btn btn-secondary">Next</button>
</div>

<script>
	document.addEventListener("DOMContentLoaded", function () {
		let currentPage = 1;
		const rowsPerPage = 7;
		const table = document.getElementById("employeeTable");
		const tbody = table.querySelector("tbody");
		const allRows = Array.from(tbody.rows); // Store all rows
		let filteredRows = [...allRows]; // Copy of rows for searching
		const totalPages = () => Math.ceil(filteredRows.length / rowsPerPage);

		function showPage(page) {
			tbody.innerHTML = "";
			const start = (page - 1) * rowsPerPage;
			const end = start + rowsPerPage;
			filteredRows.slice(start, end).forEach(row => tbody.appendChild(row));
			document.getElementById("pageInfo").innerText = `Page ${page} of ${totalPages()}`;
			document.getElementById("prevPage").disabled = page === 1;
			document.getElementById("nextPage").disabled = page === totalPages();
		}

		function searchEmployee() {
			const searchInput = document.getElementById("searchInput").value.toLowerCase();
			filteredRows = allRows.filter(row => {
				return Array.from(row.cells).some(cell => cell.innerText.toLowerCase().includes(searchInput));
			});
			currentPage = 1; // Reset to first page on new search
			showPage(currentPage);
		}

		document.getElementById("searchInput").addEventListener("keyup", searchEmployee);

		document.getElementById("prevPage").addEventListener("click", function () {
			if (currentPage > 1) {
				currentPage--;
				showPage(currentPage);
			}
		});

		document.getElementById("nextPage").addEventListener("click", function () {
			if (currentPage < totalPages()) {
				currentPage++;
				showPage(currentPage);
			}
		});

		showPage(currentPage);
	});
</script>
<script>

	document.addEventListener("DOMContentLoaded", function () {
		let isFirstCutoff = true;

		// Attach event listeners for "View" buttons
		document.querySelectorAll(".btn-view").forEach(button => {
			button.addEventListener("click", function () {
				let row = this.closest("tr");
				let employeeName = row.querySelector("td:nth-child(2) a").innerText;
				let overtime = parseInt(row.querySelector("td:nth-child(5)").innerText);
				let hoursWorked = parseInt(row.querySelector("td:nth-child(6)").innerText);

				// First Cutoff (1st - 15th)
				let grossPay = hoursWorked * 50;  // Example: Hourly rate = 50
				let overtimePay = overtime * 10;  // Example: Overtime rate = 10 per minute
				let tax = grossPay * 0.1;         // 10% tax
				let sss = 500;                    // Fixed SSS deduction
				let pagibig = 200;                // Fixed Pag-Ibig deduction
				let totalDeductions = tax + sss + pagibig;
				let netPay = grossPay - totalDeductions;

				// Populate first cutoff data
				document.getElementById("payslipEmployeeName").innerText = employeeName;
				document.getElementById("payslipMinutes").innerText = overtime;
				document.getElementById("payslipOvertime").innerText = overtimePay.toFixed(2);
				document.getElementById("payslipGrossPay").innerText = grossPay.toFixed(2);
				document.getElementById("payslipTax").innerText = tax.toFixed(2);
				document.getElementById("payslipSSS").innerText = sss.toFixed(2);
				document.getElementById("payslipPagIbig").innerText = pagibig.toFixed(2);
				document.getElementById("payslipTotalDeduction").innerText = totalDeductions.toFixed(2);
				document.getElementById("payslipNetPay").innerText = netPay.toFixed(2);

				// Show the modal
				let payslipModal = new bootstrap.Modal(document.getElementById("payslipModal"));
				payslipModal.show();

				// Ensure first cutoff data is shown initially
				isFirstCutoff = true;
			});
		});

		// Handle "Next" Cutoff button click
		document.getElementById("nextCutoff").addEventListener("click", function () {
			isFirstCutoff = !isFirstCutoff;

			if (isFirstCutoff) {
				// Show first cutoff data
				document.getElementById("payslipTitle").innerText = "Payslip - Semi-Monthly Payroll (1st Cut-off: 1st - 15th)";
			} else {
				// Show second cutoff data
				document.getElementById("payslipTitle").innerText = "Payslip - Semi-Monthly Payroll (2nd Cut-off: 16th - End of Month)";

				// Adjust values for the second cutoff
				let overtimeMinutes = parseFloat(document.getElementById("payslipMinutes").innerText) * 1.5;
				let grossPay = parseFloat(document.getElementById("payslipGrossPay").innerText) * 1.2;
				let tax = grossPay * 0.1;
				let sss = 500;
				let pagibig = 200;
				let totalDeductions = tax + sss + pagibig;
				let netPay = grossPay - totalDeductions;

				// Update Payslip Fields
				document.getElementById("payslipMinutes").innerText = overtimeMinutes.toFixed(2);
				document.getElementById("payslipOvertime").innerText = (overtimeMinutes * 10).toFixed(2);
				document.getElementById("payslipGrossPay").innerText = grossPay.toFixed(2);
				document.getElementById("payslipTax").innerText = tax.toFixed(2);
				document.getElementById("payslipSSS").innerText = sss.toFixed(2);
				document.getElementById("payslipPagIbig").innerText = pagibig.toFixed(2);
				document.getElementById("payslipTotalDeduction").innerText = totalDeductions.toFixed(2);
				document.getElementById("payslipNetPay").innerText = netPay.toFixed(2);
			}
		});
	});

</script>